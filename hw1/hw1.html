<!DOCTYPE html>
<html>
<head>
<style>
	body {
		background-color: #fff;
		color: #111;
		margin: 0px;
		overflow: hidden;
		font-family: Monospace;
		font-size: 30px;
		position: absolute;
	}
	#info {
		position: absolute;
		top: 10px; width: 100%;
		
		padding: 5px;
		text-align: center;
		color: #ffff00;
	}
	strong {color: red}
</style>
</head>

<body>

<div id="info">Press <strong>UP</strong> and <strong>DOWN</strong> to change speed<br/>
Press <strong>PageUp</strong> and <strong>PageDown</strong> to turn the volume</div>

<script src="js/three.min.js"></script>
<script src="js/OrbitControls.js"></script>
<script src="js/KeyboardState.js"></script>

<audio id="bgm" style="display:none" loop="loop">
<source src="sounds/universe_BGM_peace.mp3" type='audio/mp3'>
</audio>

<script>

var camera, scene, renderer, sun, earth, angle = 0,
    clock, control, speed = 0.05;
var earth_Mesh;
var keyboard = new KeyboardState();
var bgm = document.getElementById ("bgm");

bgm.play();
bgm.volume = 0.3;

init();
animate();

function init() {
	renderer = new THREE.WebGLRenderer({antialias: true});
    renderer.setSize(window.innerWidth, window.innerHeight);
	renderer.shadowMapEnabled = true;
	renderer.shadowMapSoft = true;

    document.body.appendChild(renderer.domElement);

    clock = new THREE.Clock();
    scene = new THREE.Scene();

	//camera
    camera = new THREE.PerspectiveCamera(50, window.innerWidth / window.innerHeight, 1, 10000);
    camera.position.z = 500;
    scene.add(camera);
	
	control = new THREE.OrbitControls(camera, renderer.domElement);

	// sphere
    sun = new THREE.Mesh(new THREE.SphereGeometry(70, 32, 32),
    new THREE.MeshBasicMaterial({map: 
	new THREE.ImageUtils.loadTexture ('images/sunmap.jpg')}));

    earth_Mesh = new THREE.Mesh(new THREE.SphereGeometry(10, 32, 32),
    new THREE.MeshLambertMaterial({map: 
	new THREE.ImageUtils.loadTexture ('images/earthmap1k.jpg')}));
	earth = new THREE.Object3D();
	earth.add (earth_Mesh);
	
    moon = new THREE.Mesh(new THREE.SphereGeometry(3, 32, 32),
    new THREE.MeshLambertMaterial({map: 
	new THREE.ImageUtils.loadTexture ('images/moonmap1k.jpg')}));
	
    earth.add(moon);
    scene.add(earth);
    scene.add(sun);
	
	var corona = new THREE.Mesh(new THREE.SphereGeometry(71, 32, 32),
    new THREE.MeshBasicMaterial({map: 
	new THREE.ImageUtils.loadTexture ('images/corona.jpg')}));
	corona.material.transparent = true;
	corona.material.opacity = 0.5;
	
	sun.add (corona);
	
	// universe
	var universe_Geo = new THREE.BoxGeometry(10000, 10000, 10000);
	var universe_Mat = new THREE.MeshLambertMaterial({map: 
	new THREE.ImageUtils.loadTexture ('images/universe1.jpg'),
	side: THREE.BackSide});
	universe_Mat.map.wrapS = universe_Mat.map.wrapT = THREE.RepeatWrapping;
	universe_Mat.map.repeat.set (2, 2);
	var universe = new THREE.Mesh (universe_Geo, universe_Mat);
	
	scene.add (universe);

	//grid
    var gridXZ = new THREE.GridHelper(100, 10);
    gridXZ.setColors(new THREE.Color(0xff0000), new THREE.Color(0xffffff));
    //scene.add(gridXZ);

	//light
    light = new THREE.PointLight(0xffffff);
    light.position.set(0, 100, 0);
    scene.add(light);

    window.addEventListener('resize', onWindowResize, false);
}

function onWindowResize() {
    camera.aspect = window.innerWidth / window.innerHeight;
    camera.updateProjectionMatrix();
    renderer.setSize(window.innerWidth, window.innerHeight);
}

function animate() {
    requestAnimationFrame(animate);
    render();
	update();
}

function update() 
{
	keyboard.update();
	control.update();
	
	if (keyboard.down ("up"))
	{
		if (speed <= 0.19)
			speed += 0.01;
	}
	if (keyboard.down ("down"))
	{
		if (speed >= 0.06)
			speed -= 0.01;
	}
	if (keyboard.down ("pageup"))
	{
		bgm.volume += 0.1;
	}
	if (keyboard.down ("pagedown"))
	{
		bgm.volume -= 0.1;
	}
}

function render() {
    angle += 1 / 180 * Math.PI * speed;

	// self rotation
	var s_angle, e_angle, m_angle;
	// angle/year
	s_angle = angle * 15;
	e_angle = angle * 365;
	m_angle = angle * 13.36;
	
	sun.rotation.y = s_angle;
	earth_Mesh.rotation.y = e_angle;
	moon.rotation.y = m_angle;
	
	// rotation
    earth.position.set(200 * Math.cos(angle), 0, -200 * Math.sin(angle));
    earth.rotation.y = angle;

    angle2 = angle * 12.36;   //+1
    moon.position.set(40 * Math.cos(angle2), 0, -40 * Math.sin(angle2));
    moon.rotation.y = angle2;
	
    renderer.render(scene, camera);
}

</script>

</body>
</html>